# 2025.07.08
3. 小蛋白模块 @孙嘉良
    i.  小蛋白设计V2.0.0 RFDiffusion, ProteinMPNN 等部分相关文献调研。

# 2025.07.15
2. 小蛋白模块 @孙嘉良
    i.  小蛋白设计V2.0.0 RFDiffusion 在服务器上部署。demo测试？（但服务器回收了，这周继续测试）, ProteinMPNN 等部分相关文献调研。
2. 小蛋白模块 @孙嘉良
    1. 小蛋白设计V2.0.0 RFDiffusion, ProteinMPNN 模块镜像开发。
1. 科前合作 @孙嘉良
    1. 抗体 IL31 改造构象预测评估进展。统计了狗抗原 can_IL31 与狗、猫、鼠抗体之间的相互作用情况。但未去除抗原上的信号肽，需补充测试。此外，需补充对于猫抗原的测试，并且猫野生型Binder的测试对HF3进行验证。

# 2025.07.22
3. 小蛋白2.0 模块开发
    1. 模块 RFDiffusion 在A100服务器上部署完成（基于conda环境，非镜像）& RFdiffusion github 中的 demo 测试跑通。正在进行不同功能下参数配置的调查以准备后续接口对接，和镜像构建准备后续迁移。
1. 科前合作 
    1. 抗体 IL31 改造构象预测评估完成。主要包括抗体猫源15H05CDR结合猫源FR或犬源FR后，对家猫或家犬抗原的测试。分析了评估的合理性，并筛选出四个（两猫两狗）指标较优秀（即残基覆盖数量 >= 10 and iptm >= 0.65）的抗体。20250718【导入】IL-31抗体HF3评估总结

# 2025.07.29
2. 小蛋白2.0 模块开发
    1. 完成模块 RFDiffusion 接口文档backbone_generation 接口文档 v0.1，在其中梳理以下功能 unconditional_monomer、protein_design（motif_scaffolding [motif 支架设计] & binder_design [binder 设计] ）、partial_diffusion、antibody_design。


             并设计一些用例对 unconditional_monomer 和 protein_design 的全参数进行测试，partial_diffusion 的部分参数测试。
    2. 模块 RFDiffusion 镜像构建跑通。代码加入到 nlp_bcp/screening_pipeline 下，暂未 push；写镜像构建脚本，待测试。

# 2025.08.05
1. 小蛋白2.0 模块开发
    1. 更新 RFDiffusion 核心参数接口文档backbone_generation 接口文档 v0.2 核心接口（基于全部参数的backbone_generation 接口文档 v0.1，保留核心参数，精简接口字典层级，以 motif_scaffolding、binder_design、antibody_design 为主要功能设计接口）。
    2. 模块 RFdiffusion 镜像&RFantibody 镜像 A800 上构建跑通（目前由于 RFantibody 中的 RFdiffusion 是特殊精调过的，并且处理脚本不同&运行环境不同，所以暂时为两个镜像）。写接口JSON处理脚本中，计划 利用接口脚本进一步做性能测试。
    3. RFdiffusion 存在的问题：
        (1) 输入时 target 在 A 链，motif 在 B 链，但是模型输出却是 target 在 B 链，motif 在 A 链，导致 例如 定义 binder 为大环肽时 inference.cyc_chains="a" 需要直接按照模型输出来写成 a，但用户很难知道这一点，正常肯定要选 motif 在输入文件中的 B 链，这不符合正常的思维。
        (2) 虽然设置了 contigmap.contigs=[A25-109/0 10-10/B17-20/0 60-70] 但是只会生成两条链，10-10/B17-20/0 60-70 这段在结果里变成了一条链，虽然实际上可能 10-10/B17-20 和 60-70 之间确实有距离，但是结果文件里它们直接连在一起标注为一条链。这导致 olig_custom_contact=["A&B,B!C"] 没意义了。

1. 科前合作 
    1. 周三开会之前，在之前结果之外，又加上了 抗体-抗原 能量评估指标。进一步进展暂无。

# 2025.08.12
1. 小蛋白2.0 模块开发
    1. 按照目前最终接口定义开发了接口脚本。
    2. A800 上初步进行资源需求测试。本周完成测试+调度文档。
1. 科前合作 
    1. 补充家犬抗原 vs. 9种家犬 CDR × 9种家犬 Framework 组成的抗体重链&轻链 的测试，目前根据 epitope_cover_15h05, total_energy, interaction_energy 筛选了四个值得关注的抗体

# 2025.08.19
1. 小蛋白2.0 模块开发
    1. 完成pipeline调度脚本&调度文档。backbone_generation 调度文档 v0.2
    2. 完成大部分资源需求测试。有两个功能(binder design, motif scaffolding)的边界还要补充测试一下。

# 2025.08.26
1. 小蛋白2.0 模块开发
    1. 实现backbone过滤模块（以 hotspots 的距离和接触数量为过滤条件）backbone_filter 接口文档
    2. 修改backbone_generation_rfdiffusion和backbone_filter的接口以接入小蛋白设计pipeline，目前inverse_folding之前的流程已跑通（一个测试用例）。

# 2025.09.02
1. 小蛋白2.0 模块开发
    1. 跑通小蛋白 pipeline（RFdiffusion+ESM-if1）的 de novo 分支，并测试 FGFR2 (最高 ipTM 29)。将 ESM-if1 替换为 ProteinMPNN (未构建镜像) 并进一步测试 FGFR2 (最高 ipTM 67)。
    2. 完善一些pipeline细节：
        ① motif 在pipeline各环节的对齐的固定；
        ② 生成序列长度参数设置；
        ③ 热点残基位置在整个Pipeline的对齐；
        ④ cif 中 target 序列的抽取 (目前是与 PyMOL 的 seq 对齐，包括增加处理修饰残基、处理断链)；
        ⑤ 骨架生成模块 RFD alpha&beta 权重初步设置 (之前默认只用 alpha 权重) 。

# 2025.09.09
1. 小蛋白2.0 模块开发
    1. 构建 "backbone 生成 -> inverse folding -> protein folding" 的迭代流程，每次迭代保留经过筛选 (目前用ipTM) 的骨架来提高生成效果。
    2. 迭代流程 (最高 ipTM 80+) 经过暂不全面的测试来看生成效果优于不迭代的单次生成。最新设计的流程 在生成的top100蛋白质上经统计分析与 内部之前版本的流程 有"显著差异"。1DJS 蛋白设计测试 (单次生成/迭代)迭代测试记录

# 2025.09.16
1. 小蛋白2.0, 迭代策略
    1. 程序：完成了两轮迭代需要的流程控制代码 & 添加了 backbone_generation_protpardelle 模块的接口代码 (快速生成骨架)；
    2. 测试：迭代测试记录
        1. 多轮迭代：20 次迭代生成 2000 个蛋白质会让进化趋近收敛，有一个好的数量和质量。10 次迭代生成 1000 个蛋白质运气不差的话也可以生成质量高的蛋白质，但数量不保证（理论上多样性也会差）。
        2. 两轮迭代：两轮的温度设置不同的情况下测了几个实验，结果目前弱于多轮迭代，感觉可能是设置问题，再测试一两次。
        3. backbone_generation_protpardelle：基于 flow model + “Protpardelle is not equivariant to rotations and translations by design.”，生成速度很快，粗略估计是 RFdiffusion 20 倍，可以几小时生成几百个骨架，但是测试中生成的 800 个骨架里只有个位数个合格骨架，生成的高 ipTM 蛋白也很少。归为弃案。

    3. 问题：有没有可能 0.01 温度 ProteinMPNN 生成的序列不适合用来评估骨架好不好？方便对比实验，但是不适合真的设计骨架。
    4. 计划：根据测试结果确定采用 两轮迭代 还是 多轮迭代。
        1. 多轮迭代：尝试添加 protein_folding 结果加入下一轮 backbone_generation 中；
        2. 两轮迭代：尝试添加 protein_folding 结果加入第二轮 inverse_folding 前。

# 2025.09.23
1. 小蛋白2.0, 迭代策略
    1. 迭代程序开发完成，protein folding 结果中骨架信息在下次迭代中复用。
    2. 结果 (基于同一批骨架测试，而不是每次 RFD 重新随机生成)：
        1. 迭代 > 不迭代；
        2. 多轮迭代 > 二轮迭代；
        3. protein folding 结果中骨架&motif信息在下次迭代中复用，在 1DJS motif scaffolding 任务上测试，有更好的效果。

# 2025.09.30
1. 小蛋白2.0, 迭代策略
    1. 小蛋白 2.0 pipeline 三种模式 (denovo, denovo_rag, reference) 均测试跑通。
    2. 一些完善pipeline的改动：
        1. 建 ProteinMPNN 镜像后修改 pipeline 中调用 inverse_folding 模块处的代码； 修改一些跑通流程所需代码。
        2. 多样性评估，基于 pair-wise TM-score；
        3. RFdiffution 后续的 backbone filter 增加默认至少保留 1 个的设置 (目前还没遇到全不通过筛选的情况)。
        4. 增加 生成结果的聚类 (基于 pair-wise TM-score) 和 树状图 (基于层次聚类) 的数据，准备用于后续在前端页面上展示。
    3. FGFR2c 1DJS RFdiffusion 生成的189个骨架 All Backbones Mean pairwise Tm-Score: 0.2144，设计的蛋白 ipTM Top-100 mean pairwise Tm-score: 0.2346
    4. 第一个IL7Ra靶点大规模测试 (denovo_rag): 
        1. 设计数量1000个，生成骨架200个，逆折叠温度 0.1

# 2025.10.14
1. 小蛋白2.0, 大规模测试
    1. 小蛋白 2.0 pipeline 在四种模式下 denovo, denovo_rag, denovo_iter, denovo_rag_iter 下大规模测试。
        1. 目前在 IL7Ra(3di3)、TrkA(1www)、InsulinR(4zxb)、PDGFR(3mjg) 上进行了测试。
主要指标：设计出ipTM >= 0.6 蛋白数量、设计出ipTM >= 0.8 蛋白数量、Top10% ipTM 样本的平均 ipTM、Top100 ipTM 样本的平均 ipTM、设计的蛋白多样性
    2. 测试结果：测试记录小蛋白2.0 大规模测试记录
        1. 使用迭代 (包括 denovo_iter) 会提高 平均 ipTM 10%-15% (相比 denovo、denovo_rag)。
        2. denovo 和 denovo_rag 在上述指标上各有优劣
            1. 在 IL7Ra、PDGFR 上，denovo 明显优于 denovo_rag。在 InsulinR 上，denovo_rag 明显优于 denovo。
            2. 在 TrkA 上，denovo_rag 设计的蛋白质的多样性更高。在 IL7Ra、InsulinR 上 denovo 设计的蛋白质的多样性更高。
        3. backbone_filter 的影响：
            1. 无 backbone_filter 的迭代 (包括 denovo_iter) 会比 有 backbone_filter 的迭代效果更好。
            2. 有 backbone_filter 的 denovo 和 denovo_rag 会比 有 backbone_filter 的 denovo 和 denovo_rag 效果更好。
    3. 进行更多实验：
        1. denovo_rag 模式新方案探索：不固定 rag_seed 中 motif 的结构 (保留残基类型)，是否可以提升 denovo_rag 效果。
    4. 按照 ESM-if1 相似接口写了小蛋白 2.0 的 ProteinMPNN 接口文档和调度文档。

